<!--mine.wxml-->
<header showBack="{{true}}"></header>

<view style="margin-top: {{navBarHeight}}px;">
  <view class="container">
    <!-- 第一部分：用户信息区域 -->
    <view class="user-info-section">
      <view class="user-info-wrapper">
        <block wx:if="{{!hasUserInfo}}">
          <view class="avatar-container">
            <view class="avatar-placeholder"></view>
          </view>
          <view class="user-detail">
            <button class="login-btn" bindtap="getUserProfile">微信一键登录</button>
          </view>
        </block>
        <block wx:else>
          <view class="avatar-container">
            <button class="avatar-wrapper" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
              <image class="user-avatar" src="{{avatarUrl || userInfo.avatarUrl}}" mode="aspectFill"></image>
              <view class="edit-avatar">更换</view>
            </button>
          </view>
          <view class="user-detail">
            <view class="user-name-row">
              <text class="user-name">{{userInfo.nickName}}</text>
              <text class="welcome-text">{{welcomeMessage}}</text>
            </view>
            <view class="user-role">{{userExtInfo.department}}{{userExtInfo.role}}</view>
            <view class="user-group">{{userExtInfo.group}}</view>
            
            <view class="phone-section">
              <block wx:if="{{phoneNumber}}">
                <text class="phone-number">微信绑定手机：{{phoneNumber}}</text>
              </block>
              <block wx:else>
                <button class="phone-btn" open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber">绑定手机号</button>
              </block>
            </view>
          </view>
        </block>
      </view>
    </view>
    
    <!-- 第二部分：状态信息区域 -->
    <view class="status-section">
      <view class="status-item" bindtap="goToNotifications">
        <view class="status-icon stuff">
        <view class="status-number">{{userStats.todoCount}}</view>
        </view>
        <view class="status-label">待办事项</view>
      </view>
      <view class="status-item">
        <view class="status-icon welcome-icon">!</view>
        <view class="status-label">欢迎访问菌材通</view>
      </view>
      <view class="status-item">
        <view class="status-icon {{userStats.isVerified ? 'verified-icon' : 'unverified-icon'}}">
          {{userStats.isVerified ? '√' : '?'}}
        </view>
        <view class="status-label">{{userStats.isVerified ? '已认证' : '未认证'}}</view>
      </view>
    </view>
    
    <!-- 测试按钮 - 隐藏在界面中 -->
    <view class="test-button" bindtap="addTestNotification">添加测试通知</view>
    
    <!-- 第三部分：功能菜单区域 -->
    <view class="menu-section">
      <view class="menu-list">
        <view class="menu-item" wx:for="{{menuList}}" wx:key="index" bindtap="navigateToPage" data-index="{{index}}">
          <view class="menu-icon {{item.icon}}"></view>
          <view class="menu-text">{{item.text}}</view>
          <view class="menu-arrow"></view>
        </view>
      </view>
    </view>
    
    <!-- 版本信息 -->
    <view class="version-info">
      <text>版本 1.0.0</text>
    </view>
  </view>
</view> 