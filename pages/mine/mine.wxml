<!--mine.wxml-->
<header showBack="{{true}}"></header>

<view style="margin-top: {{navBarHeight}}px;">
  <view class="container">
    <!-- 第一部分：用户信息区域 -->
    <view class="user-info-section">
      <view class="user-info-wrapper">
        <block wx:if="{{!isLoggedIn}}">
          <view class="avatar-container">
            <view class="avatar-placeholder"></view>
          </view>
          <view class="user-detail">
            <button class="login-btn" bindtap="getUserProfile" loading="{{loginBtnLoading}}">微信一键登录</button>
          </view>
        </block>
        <block wx:else>
          <view class="avatar-container">
            <!-- 修改头像选择按钮 -->
            <button class="avatar-wrapper" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
              <image class="user-avatar" src="{{avatarUrl || userInfo.avatarUrl || '/images/app_default.png'}}" mode="aspectFill"></image>
            </button>
          </view>
          <view class="user-detail">
            <view class="user-name-row">
              <text class="user-name">{{userInfo.userName || userInfo.nickName || '微信用户'}}</text>
              <text class="welcome-text">欢迎您！</text>
            </view>
            
            <view class="user-info-row" wx:if="{{userInfo.studentId}}">
              <text class="info-label">学号：</text>
              <text class="info-value">{{userInfo.studentId}}</text>
            </view>
            
            <view class="phone-section">
              <block wx:if="{{phoneNumber}}">
                <text class="phone-number">手机号：{{phoneNumber}}</text>
              </block>
              <block wx:elif="{{needPhoneBind}}">
                <button class="phone-btn" bindtap="getPhoneNumber">绑定信息</button>
              </block>
              <block wx:else>
                <button class="phone-btn" bindtap="getPhoneNumber">完善个人信息</button>
              </block>
            </view>
          </view>
        </block>
      </view>
    </view>
    
    <!-- 第二部分：状态信息区域 -->
    <view class="status-section">
      <view class="status-item" bindtap="goToNotifications">
        <view class="status-icon stuff">
          @
          <view class="status-number">{{userStats.todoCount}}</view>
        </view>
        <view class="status-label">待办事项</view>
      </view>
      <view class="status-item">
        <view class="status-icon welcome-icon">!</view>
        <view class="status-label">欢迎访问菌材通</view>
      </view>
      <view class="status-item" bindtap="{{!userStats.isVerified && isLoggedIn ? 'verifyUser' : ''}}">
        <view class="status-icon {{userStats.isVerified && isLoggedIn ? 'verified-icon' : 'unverified-icon'}}">
          {{userStats.isVerified && isLoggedIn ? '√' : '?'}}
        </view>
        <view class="status-label">{{userStats.isVerified && isLoggedIn ? '已认证' : '未认证'}}</view>
      </view>
    </view>
    
    <!-- 测试按钮 - 隐藏在界面中 -->
    <view class="test-button" bindtap="addTestNotification">添加测试通知</view>
    
    <!-- 第三部分：功能菜单区域 -->
    <view class="menu-section" wx:if="{{isLoggedIn}}">
      <view class="menu-item" bindtap="logout">
        <view class="menu-icon logout-icon">⏏</view>
        <view class="menu-label">退出登录</view>
        <view class="menu-arrow">></view>
      </view>
    </view>
    
    <!-- 版本信息 -->
    <view class="version-info">
      <text>版本 1.0.0</text>
    </view>
  </view>
</view> 